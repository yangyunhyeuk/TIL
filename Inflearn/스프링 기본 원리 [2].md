### BeanFactory와 ApplicationContext

- BeanFactory
    - 스프링 컨테이너의 최상위 인터페이스
    - 스프링 빈을 관리하고 조회하는 역할
    - getBean()을 제공한다.
    
- ApplicationContext
    - BeanFactory 기능을 모두 상속받아 제공한다.
    - 빈을 관리하고 검색하는 기능을 Bean Factory가 제공해주는데, 둘의 차이는 뭘까
    - 애플리케이션을 개발할 대 빈을 관리, 조회하는 기능은 물론이고 수많은 부가기능이 필요하다. 이를 ApplicationContext가 도맡아 수행한다.
        - 메시지 소스를 활용한 국제화 기능
        - 환경 변수
        - 애플리케이션 이벤트
        - 편리한 리소스 조회

---

### 빈 등록에 있어서 AppConfig와 xml 설정 차이

![1](https://user-images.githubusercontent.com/56379649/167175040-855d3612-7afe-4fba-95e9-9dc21ac8a3e6.png)


![2](https://user-images.githubusercontent.com/56379649/167175074-d70a6371-2a63-4a92-9d28-4bae72375a25.png)


================================================================

![3](https://user-images.githubusercontent.com/56379649/167175125-bc87fcca-34d0-4d1f-a802-19fad7e0d771.png)




### 웹 애플리케이션과 싱글톤

- 스프링은 태생이 기업용 온라인 서비스 기술을 지원하기 위해 탄생하였다.
- 대부분의 스프링 어플리케이션은 웹 어플리케이션이다.
- 웹 어플리케이션은 보통 여러 고객이 동시에 요청을 한다.
- 고객의 요청할 때마다 작업 수행을 위한 객체가 매번 생성되면 메모리 낭비가 심하다.
- 해결방안으로는 해당 객체가 딱 1번 생성되고 공유하도록 설계하면 된다 (싱글톤 패턴)

> 싱글톤 패턴
> 

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/72ecd642-2738-4769-9095-22577b9d4643/Untitled.png)

클래스와 인스턴스가 딱 1개만 생성되는 것을 보장하는 디자인 패턴이다. 

그래서 객체 인스턴스가 2개 이상 생성되지 못하도록 막아야 한다. 

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/df11aacf-b92a-4380-b2fe-a7ba7ba1d5ff/Untitled.png)

출력 결과는 다음과 같다. 

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c2f39661-8840-4558-a0ce-7252aa226fb2/Untitled.png)

> 참고로 싱글톤 패턴을 구현하는 방법은 여러가지이나, 여기서는 객체를 미리 생성해두는 가장 단순하고 안전한 방법을 선택했다.
> 

싱글톤 패턴을 적용하면 고객의 요청이 올 때마다 객체를 생성하는 것이 아니라, 이미 만들어진 객체를 공유해서 효율적으로 사용할 수 있다. 하지만 싱글톤 패턴의 이러한 장점 이면에 수많은 단점도 존재한다. 

“싱글톤 패턴의 문제점”

- 싱글톤 패턴을 구현하는 코드 자체가 많이 들어간다.
- 클라이언트가 구현체 클래스에 의존해야 한다. 이는 DIP(구현 클래스가 아닌 인터페이스에 의존)를 위반한다.
    
    ⇒ getInstance()를 수행해야 하기 때문이다. 
    
- 클라이언트가 구현체 클래스에 의존하기 때문에 OCP 원칙을 위반할 가능성이 높다.
- 유연하게 테스트하기엔 한계가 존재한다.
- private 생성자를 사용하기에 자식 클래스를 만들기 어렵다.
- 결론적으로 유연성이 떨어진다.
- 이는 안티패턴으로도 불리기도 한다.

---

### 싱글톤 컨테이너

스프링 컨테이너는 싱글톤 패턴의 문제점을 해결하면서 객체 인스턴스를 싱글톤으로 관리한다. 

“싱글톤 컨테이너”

- 스프링 컨테이너는 싱글톤 컨테이너 역할을 하며 이렇게 싱글톤 객체를 생성하고 관리하는 기능을 싱글톤 레지스트리라고 한다.
- 싱글톤 패턴 구현을 위해 지저분한 코드가 들어가지 않아도 된다.

> 싱글톤 방식의 문제점
> 

스프링 빈은 항상 무상태(Stateless)로 설계해야 한다.

“StatefulService”의 “price” 멤버변수는 같은 객체로 공유되는 필드인데 특정 클라이언트가 값을 변경할 시

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d64c45be-e752-4fef-9074-c5c0a0832ec7/Untitled.png)

이전 사용자가 주문한 값을 출력할 경우 뒤이어 주문한 사용자가 주문한 값으로 대체되어 출력된다. 

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/55908966-bdce-4410-903c-16686757328c/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/44b1d3fc-a63f-4140-8086-fd3f6f18b2e9/Untitled.png)

그에 대한 해결 방안으로 특정 클라이언트에 의해 변경될 소지가 있는 변수를 생성하지 않으면 된다. 

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6e2aa429-0573-4b68-b1e1-010140e4d1d8/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8a122f75-7787-4956-9a0a-cecdcea772b4/Untitled.png)

---

@Configuration과 바이트코드 조작의 마법

다음의 코드를 테스트하면 

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/34603bf3-7b65-47ad-a36f-b755b976edcb/Untitled.png)

출력 결과가 다음과 같이 나온다. 

`bean = class hello.demo.AppConfig$$EnhancerBySpringCGLIB$$46de1e71`

이는 내가 만든 클래스가 아니라 스프링이 CGLIB이라는 바이트코드 조작 라이브러리를 사용하여 Appconfig 클래스를 상속받은 임의의 다른 클래스를 만들고, 그 다른 클래스를 스프링 빈으로 등록한 것을 의미한다. 

이 임의의 다른 클래스가 바로 싱글톤이 보장되도록 해주는 것이다. 

 “정리”

- @Bean만 사용해도 스프링 빈으로 등록되지만 싱글톤은 보장되지 않는다.
- 그래서 스프링 설정 정보는 싱글톤 패턴을 보장해주는 @Configuration을 사용한다.

---
